{"version":3,"file":"util.js","sourceRoot":"","sources":["../../../src/lib/util.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * Utility functions for arangojs.\r\n *\r\n * @packageDocumentation\r\n * @internal\r\n */\r\n\r\nconst THIRTY_MINUTES = 30 * 60_000;\r\n\r\n/**\r\n * @internal\r\n *\r\n * Helper to merge path segments.\r\n */\r\nexport function joinPath(...pathList: (string | undefined)[]): string {\r\n  if (!pathList.length) return \"\";\r\n  return pathList\r\n    .flatMap((path, i) => {\r\n      if (!path) return [];\r\n      if (i === pathList.length - 1) {\r\n        if (i === 0) return [path];\r\n        return [path.replace(/^\\/+/, \"\")];\r\n      }\r\n      if (i === 0) return [path.replace(/\\/+$/, \"\")];\r\n      return [path.replace(/^\\/+|\\/+$/, \"\")];\r\n    })\r\n    .join(\"/\");\r\n}\r\n\r\n/**\r\n * @internal\r\n *\r\n * Utility function for merging headers.\r\n */\r\nexport function mergeHeaders(\r\n  ...headersList: (\r\n    | Headers\r\n    | string[][]\r\n    | Record<string, string | ReadonlyArray<string>>\r\n    | undefined\r\n  )[]\r\n) {\r\n  if (!headersList.length) return new Headers();\r\n  return new Headers([\r\n    ...headersList.flatMap((headers) =>\r\n      headers\r\n        ? [\r\n            ...(headers instanceof Headers || Array.isArray(headers)\r\n              ? headers\r\n              : new Headers(headers)),\r\n          ]\r\n        : [],\r\n    ),\r\n  ]);\r\n}\r\n\r\n/**\r\n * @internal\r\n *\r\n * Utility function for normalizing URLs.\r\n */\r\nexport function normalizeUrl(url: string): string {\r\n  const raw = url.match(/^(tcp|ssl|tls)((?::|\\+).+)/);\r\n  if (raw) url = (raw[1] === \"tcp\" ? \"http\" : \"https\") + raw[2];\r\n  const unix = url.match(/^(?:(http|https)\\+)?unix:\\/\\/(\\/.+)/);\r\n  if (unix) url = `${unix[1] || \"http\"}://unix:${unix[2]}`;\r\n  else if (!url.endsWith(\"/\")) url += \"/\";\r\n  return url;\r\n}\r\n\r\n/**\r\n * @internal\r\n *\r\n * Generate a unique request ID.\r\n */\r\nexport function generateRequestId() {\r\n  return `${Date.now() % THIRTY_MINUTES}_${Math.random().toString(36).substring(2, 15)}`;\r\n}\r\n\r\n/**\r\n * @internal\r\n *\r\n * Creates a timer that will call the given callback after the specified\r\n * timeout.\r\n *\r\n * @param timeout - Number of milliseconds after which the callback will be\r\n *   called.\r\n * @param callback - Callback to call after the timeout.\r\n * @returns A function that clears the timer.\r\n */\r\nexport function createTimer(timeout: number, callback: () => void) {\r\n  const t = setTimeout(callback, timeout);\r\n  return () => clearTimeout(t);\r\n}\r\n\r\n/**\r\n * @internal\r\n *\r\n * Generates a stack trace.\r\n */\r\nexport function generateStackTrace() {\r\n  let err = new Error();\r\n  if (!err.stack) {\r\n    try {\r\n      throw err;\r\n    } catch (e: any) {\r\n      err = e;\r\n    }\r\n  }\r\n  return err;\r\n}\r\n"]}